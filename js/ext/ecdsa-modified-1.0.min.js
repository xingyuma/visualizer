/*! ecdsa-modified-1.0.0.js (c) Stephan Thomas, Kenji Urushima | github.com/bitcoinjs/bitcoinjs-lib/blob/master/LICENSE
 */
if(typeof KJUR=="undefined"||!KJUR){KJUR={}}if(typeof KJUR.crypto=="undefined"||!KJUR.crypto){KJUR.crypto={}}KJUR.crypto.ECDSA=function(e){var d="secp256r1";if(typeof e!="undefined"){if(typeof e.curve!="undefined"){d=e.curve}}this.ecparams=KJUR.crypto.ECParameterDB.getByName(d);var a=new SecureRandom();var c=null;function b(p,h,o,g){var f=Math.max(h.bitLength(),g.bitLength());var q=p.add2D(o);var n=p.curve.getInfinity();for(var j=f-1;j>=0;--j){n=n.twice2D();n.z=BigInteger.ONE;if(h.testBit(j)){if(g.testBit(j)){n=n.add2D(q)}else{n=n.add2D(p)}}else{if(g.testBit(j)){n=n.add2D(o)}}}return n}this.getBigRandom=function(f){return new BigInteger(f.bitLength(),a).mod(f.subtract(BigInteger.ONE)).add(BigInteger.ONE)};this.generateKeyPairHex=function(){var h=this.ecparams.n;var k=this.getBigRandom(h);var i=this.ecparams.G.multiply(k);var n=i.getX().toBigInteger();var l=i.getY().toBigInteger();var f=this.ecparams.keylen/4;var j=("0000000000"+k.toString(16)).slice(-f);var o=("0000000000"+n.toString(16)).slice(-f);var m=("0000000000"+l.toString(16)).slice(-f);var g="04"+o+m;return{ecprvhex:j,ecpubhex:g}};this.signHex=function(l,g){var t=new BigInteger(g,16);var i=this.ecparams.n;var p=new BigInteger(l,16);do{var j=this.getBigRandom(i);var u=this.ecparams.G;var m=u.multiply(j);var f=m.getX().toBigInteger().mod(i)}while(f.compareTo(BigInteger.ZERO)<=0);var v=j.modInverse(i).multiply(p.add(t.multiply(f))).mod(i);var q=new KJUR.asn1.DERInteger({bigint:f});var o=new KJUR.asn1.DERInteger({bigint:v});var h=new KJUR.asn1.DERSequence({array:[q,o]});return h.getEncodedHex()};this.sign=function(i,p){var m=p;var g=this.ecparams.n;var l=BigInteger.fromByteArrayUnsigned(i);do{var h=this.getBigRandom(g);var o=this.ecparams.G;var j=o.multiply(h);var f=j.getX().toBigInteger().mod(g)}while(f.compareTo(BigInteger.ZERO)<=0);var q=h.modInverse(g).multiply(l.add(m.multiply(f))).mod(g);return this.serializeSig(f,q)};this.verifyHex=function(j,f,m){var i,g;var l=this.parseSigHex(f);i=l.r;g=l.s;var h;h=ECPointFp.decodeFromHex(this.ecparams.curve,m);var k=new BigInteger(j,16);return this.verifyRaw(k,i,g,h)};this.verify=function(l,m,g){var i,f;if(Bitcoin.Util.isArray(m)){var k=this.parseSig(m);i=k.r;f=k.s}else{if("object"===typeof m&&m.r&&m.s){i=m.r;f=m.s}else{throw"Invalid value for signature"}}var h;if(g instanceof ECPointFp){h=g}else{if(Bitcoin.Util.isArray(g)){h=ECPointFp.decodeFrom(this.ecparams.curve,g)}else{throw"Invalid format for pubkey value, must be byte array or ECPointFp"}}var j=BigInteger.fromByteArrayUnsigned(l);return this.verifyRaw(j,i,f,h)};this.verifyRaw=function(k,f,q,j){var i=this.ecparams.n;var p=this.ecparams.G;if(f.compareTo(BigInteger.ONE)<0||f.compareTo(i)>=0){return false}if(q.compareTo(BigInteger.ONE)<0||q.compareTo(i)>=0){return false}var l=q.modInverse(i);var h=k.multiply(l).mod(i);var g=f.multiply(l).mod(i);var m=p.multiply(h).add(j.multiply(g));var o=m.getX().toBigInteger().mod(i);return o.equals(f)};this.serializeSig=function(h,g){var i=h.toByteArraySigned();var f=g.toByteArraySigned();var j=[];j.push(2);j.push(i.length);j=j.concat(i);j.push(2);j.push(f.length);j=j.concat(f);j.unshift(j.length);j.unshift(48);return j};this.parseSig=function(k){var j;if(k[0]!=48){throw new Error("Signature not a valid DERSequence")}j=2;if(k[j]!=2){throw new Error("First element in signature must be a DERInteger")}var i=k.slice(j+2,j+2+k[j+1]);j+=2+k[j+1];if(k[j]!=2){throw new Error("Second element in signature must be a DERInteger")}var f=k.slice(j+2,j+2+k[j+1]);j+=2+k[j+1];var h=BigInteger.fromByteArrayUnsigned(i);var g=BigInteger.fromByteArrayUnsigned(f);return{r:h,s:g}};this.parseSigHex=function(g){if(g.substr(0,2)!="30"){throw"signature is not a ASN.1 sequence"}var f=ASN1HEX.getPosArrayOfChildren_AtObj(g,0);if(f.length!=2){throw"number of signature ASN.1 sequence elements seem wrong"}var l=f[0];var j=f[1];if(g.substr(l,2)!="02"){throw"1st item of sequene of signature is not ASN.1 integer"}if(g.substr(j,2)!="02"){throw"2nd item of sequene of signature is not ASN.1 integer"}var i=ASN1HEX.getHexOfV_AtObj(g,l);var h=ASN1HEX.getHexOfV_AtObj(g,j);var m=new BigInteger(i,16);var k=new BigInteger(h,16);return{r:m,s:k}};this.parseSigCompact=function(j){if(j.length!==65){throw"Signature has the wrong length"}var f=j[0]-27;if(f<0||f>7){throw"Invalid signature type"}var k=this.ecparams.n;var h=BigInteger.fromByteArrayUnsigned(j.slice(1,33)).mod(k);var g=BigInteger.fromByteArrayUnsigned(j.slice(33,65)).mod(k);return{r:h,s:g,i:f}}};